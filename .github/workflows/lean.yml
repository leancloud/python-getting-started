name: Test Deploy to LeanEngine

on:
  push:
    branches: [ master ]
    paths-ignore:
      - '**.md'

  pull_request:
    branches: [ master ]
    paths-ignore:
      - '**.md'

jobs:
  build:

    runs-on: ubuntu-latest
    steps:
      - name: Install lean-cli
        run: |
          mkdir .leancloud
          wget --quiet -O .leancloud/lean https://github.com/leancloud/lean-cli/releases/download/v0.23.0/lean-linux-x64
          chmod a+x .leancloud/lean

      - name: Login
        env:
          LC_USER: ${{ secrets.LEANCLICI }}
          PASSWORD: ${{ secrets.PASSWORD }}
        run: .leancloud/lean login --username "$LC_USER" --password "$PASSWORD" --region US

      - name: Connect
        env:
          APPID: ${{ secrets.PYTHON_FLASK_CI }}
        run: .leancloud/lean switch --region US --group web "$APPID"

      - name: Deploy
        run: .leancloud/lean deploy
    
